{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/itssamboakye/Documents/Nson/EnableOS/hume-typescript-sdk/app/api/feedback/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\n\nexport const runtime = \"nodejs\";\n\ninterface FeedbackRequest {\n  transcript: Array<{\n    role: \"user\" | \"assistant\";\n    text: string;\n    timestamp: number;\n  }>;\n}\n\nexport async function POST(request: Request) {\n  try {\n    const { transcript }: FeedbackRequest = await request.json();\n\n    if (!transcript || transcript.length === 0) {\n      return NextResponse.json(\n        { error: \"No transcript provided\" },\n        { status: 400 }\n      );\n    }\n\n    const apiKey = process.env.OPENAI_API_KEY;\n    if (!apiKey) {\n      return NextResponse.json(\n        { error: \"OpenAI API key not configured\" },\n        { status: 500 }\n      );\n    }\n\n    // Format transcript for OpenAI\n    const messages = transcript.map((entry) => ({\n      role: entry.role === \"user\" ? \"user\" : \"assistant\",\n      content: entry.text,\n    }));\n\n    // System prompt based on ATLAS feedback format\n    const systemPrompt = `You are ATLAS, the Discovery Practice Coach. Analyze this discovery call transcript and provide structured feedback.\n\nIMPORTANT: If the conversation is very short, lacks substance, or didn't gather meaningful information, clearly state this in your feedback.\n\nProvide feedback in the following JSON format:\n{\n  \"summary\": [\"bullet point 1\", \"bullet point 2\", \"bullet point 3\"],\n  \"scorecard\": {\n    \"clarity\": number (0-10),\n    \"curiosity\": number (0-10),\n    \"listening\": number (0-10),\n    \"flow\": number (0-10),\n    \"confidence\": number (0-10),\n    \"nextSteps\": number (0-10)\n  },\n  \"strengths\": [\"strength 1\", \"strength 2\", \"strength 3\"],\n  \"improvements\": [\n    {\n      \"issue\": \"what happened\",\n      \"impact\": \"why it matters\",\n      \"example\": \"rewritten example they could say\"\n    },\n    {\n      \"issue\": \"what happened\",\n      \"impact\": \"why it matters\",\n      \"example\": \"rewritten example they could say\"\n    },\n    {\n      \"issue\": \"what happened\",\n      \"impact\": \"why it matters\",\n      \"example\": \"rewritten example they could say\"\n    }\n  ],\n  \"drill\": \"one short, repeatable exercise for next time\",\n  \"insufficientData\": boolean (true if not enough info was gathered)\n}`;\n\n    const response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${apiKey}`,\n      },\n      body: JSON.stringify({\n        model: \"gpt-4o-mini\",\n        messages: [\n          { role: \"system\", content: systemPrompt },\n          ...messages,\n        ],\n        response_format: { type: \"json_object\" },\n        temperature: 0.7,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      console.error(\"OpenAI API error:\", error);\n      return NextResponse.json(\n        { error: \"Failed to generate feedback\" },\n        { status: 500 }\n      );\n    }\n\n    const data = await response.json();\n    const feedbackContent = data.choices[0]?.message?.content;\n\n    if (!feedbackContent) {\n      return NextResponse.json(\n        { error: \"No feedback generated\" },\n        { status: 500 }\n      );\n    }\n\n    const feedback = JSON.parse(feedbackContent);\n\n    return NextResponse.json({ feedback });\n  } catch (error) {\n    console.error(\"Error generating feedback:\", error);\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : \"Failed to generate feedback\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,UAAU;AAUhB,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,UAAU,EAAE,GAAoB,MAAM,QAAQ,IAAI;QAE1D,IAAI,CAAC,cAAc,WAAW,MAAM,KAAK,GAAG;YAC1C,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QACzC,IAAI,CAAC,QAAQ;YACX,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,+BAA+B;QAC/B,MAAM,WAAW,WAAW,GAAG,CAAC,CAAC,QAAU,CAAC;gBAC1C,MAAM,MAAM,IAAI,KAAK,SAAS,SAAS;gBACvC,SAAS,MAAM,IAAI;YACrB,CAAC;QAED,+CAA+C;QAC/C,MAAM,eAAe,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAmCzB,CAAC;QAEE,MAAM,WAAW,MAAM,MAAM,8CAA8C;YACzE,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,eAAe,CAAC,OAAO,EAAE,QAAQ;YACnC;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO;gBACP,UAAU;oBACR;wBAAE,MAAM;wBAAU,SAAS;oBAAa;uBACrC;iBACJ;gBACD,iBAAiB;oBAAE,MAAM;gBAAc;gBACvC,aAAa;YACf;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,QAAQ,MAAM,SAAS,IAAI;YACjC,QAAQ,KAAK,CAAC,qBAAqB;YACnC,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA8B,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,MAAM,kBAAkB,KAAK,OAAO,CAAC,EAAE,EAAE,SAAS;QAElD,IAAI,CAAC,iBAAiB;YACpB,OAAO,+QAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwB,GACjC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAW,KAAK,KAAK,CAAC;QAE5B,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE;QAAS;IACtC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAA8B,GAChF;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}